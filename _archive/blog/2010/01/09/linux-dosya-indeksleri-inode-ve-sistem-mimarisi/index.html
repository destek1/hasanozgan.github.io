
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Linux Dosya Indeksleri (inode) ve Sistem Mimarisi</title>
    
    <meta name="author" content="Hasan Ozgan">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/heves/css/bootstrap-combined.min.css" rel="stylesheet">
    <link href="/assets/themes/heves/css/docs.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/heves/js/google-code-prettify/prettify.css" rel="stylesheet">
    <link href="/assets/themes/heves/css/followbox.css" rel="stylesheet" type="text/css"/>

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
</head>

<body>

<div class="navbar navbar-fixed-top">
<a href="http://www.reactivemanifesto.org/"><img style="border: 0; position: fixed; right: 0; top:41px; z-index: 9000" src="http://www.reactivemanifesto.org/images/ribbons/we-are-reactive-red-right.png"></a> 
    <div class="navbar-inner">
        <div class="container" style="width:1200px">
           <a class="brand" href="/">Internet Stratejileri, Yazılım Geliştirme ve Mimarileri Üzerine</a>

            <div class="nav-collapse">
                <ul class="nav">
                    <li>
                        <a href="/"><i class="icon-home"></i> Anasayfa</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-briefcase"></i> Belgeler <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        	<li><a href="/blog/2013/03/30/fonksiyonel-programlama/" target="_blank">Fonksiyonel Programlama</a></li>
                            <li><a href="/belgeler/scala-rehberi" rel="tooltip" title="Scala Rehberi" target="_blank">Scala Rehberi</a></li>
                            <li><a href="/belgeler/tasarim-desenleri" rel="tooltip" title="Tasarım Desenleri" target="_blank">Tasarım Desenleri</a></li>
                            <li><a href="/belgeler/tasarim-prensipleri" rel="tooltip" title="Tasarım Prensipleri" target="_blank">Tasarım Prensipleri</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="https://github.com/HasanOzgan"><i class="icon-globe"></i> Projeler</a>
                    </li>
                    <li><a href="/archive"><i class="icon-folder-open"></i> Arşiv</a></li>
                    <li>
                        <a href="/hakkinda"><i class="icon-user"></i> Hakkımda</a>
                    </li>
                    
                </ul>
            </div>

        </div>
    </div>
</div>

<div class="container">
    <div class="marketing">
        <div class="content">
            


<div class="row">
    <div class="span12 column">
        <p></p><h1>Linux Dosya Indeksleri (inode) ve Sistem Mimarisi</h1><p></p>
    </div>
</div>

<div class="row">
    <div class="span8 column">
        <!--<h5><strong>Ocak 09, 2010 <small> | <a href="/blog/2010/01/09/linux-dosya-indeksleri-inode-ve-sistem-mimarisi#disqus_thread" data-disqus-identifier="/blog/2010/01/09/linux-dosya-indeksleri-inode-ve-sistem-mimarisi">Yorumlar</a></small></strong><br>-->

        
            <i class="icon-tags"></i> Etiketler :
            
                <a href="tag/Diğer" rel="tooltip" title="View posts tagged with &quot;Diğer&quot;"><span class="label label-info">Diğer</span></a>
            
        


    </div>
    <div class="span4 column">
        <p class="pull-right">
            
            <a href="/blog/2009/12/03/pratisyen-hekim-veya-kalp-cerrahi-olmak" title="Pratisyen Hekim veya Kalp Cerrahı Olmak"><i class="icon-chevron-left"></i></a>
            
            
            <a href="/blog/2010/01/13/sanal-pos-kutuphanesi" title="Sanal Pos Kütüphanesi"><i class="icon-chevron-right"></i></a>
            
        </p>
    </div>
</div>

<div class="row">
  <div class="span12">
    <hr style="margin: 30px 0 30px 0"/>

      <style>
	.info {
		border: none;
		margin: 3px;
		text-align: left;
		width: 500px;
	}
</style>

<p>Birkaç gündür <a href="http://kissa.be">kissa.be</a> servisinin bulunduğu sunucu, diskte yer yok hatası nedeniyle düzgün bir şekilde hizmet veremiyordu. Durumu farkeder farketmez, diskteki yerimi kontrol ettiğimde gördüm ki; diskin %80'lik bir bölümü halen boş. Sorunun sunucu hizmeti aldığım firmayla görüşünce, anlaşıldı ki, diske format atarken varsayılan değerlerini aynen kabul ettiğim dosya indekslerimin (inode size) tükendiği için bu hatayı aldığım anlaşıldı.</p>

<p>Diskte mevcut inode sayısını görmek için;</p>

<blockquote>
	<table class="info">
		<tr>
			<td colspan="5"><p>root@localhost:~#<strong> df -ih</strong></p></td>
		</tr>
		<tr>
			<th>Filesystem</th>
			<th>Inodes</th>
			<th>IUsed</th>
			<th>IFree</th>
			<th>IUse%</th>
			<th>Mounted on</th>		
		</tr>
		<tr>
			<td>/dev/sda</td>
			<td>680K</td>
			<td>21K</td>
			<td>660K</td>
			<td>3%</td>		
			<td>/</td>		
		</tr>	
		<tr>
			<td>/dev/sdc</td>
			<td>1.3M</td>
			<td>25K</td>
			<td>1.2M</td>
			<td>2%</td>		
			<td>/files	</td>		
		</tr>
	</table>
</blockquote>

<p>Diskteki mevcut boş alanı görmek için ise;</p>

<blockquote>

	<table class="info">
		<tr>
			<td colspan="5"><p>root@localhost:~#<strong> df -h</strong></p></td>
		</tr>
		<tr>
			<th>Filesystem</th>
			<th>Size</th>
			<th>Used</th>
			<th>Avail</th>
			<th>Use%</th>
			<th>Mounted on</th>		
		</tr>
		<tr>
			<td>/dev/sda</td>
			<td>11G</td>
			<td>741M</td>
			<td>9.5G</td>
			<td>8%</td>
			<td>/</td>		
		</tr>	
		<tr>
			<td>/dev/sdc</td>
			<td>4.8G</td>
			<td>960M</td>
			<td>3.6G</td>
			<td>21%</td>
			<td>/files</td>		
		</tr>
	</table>
</blockquote>

<p><a href="http://kissa.be">Kissa.be</a> resim ve metin gibi dosyaları saklamanıza yarayan bir servis olduğu için çok küçük oranlarda çok fazla dosya bulundurabiliyor bünyesinde. Bu da dosya indeks limitimin hızlı bir şekilde tükenmesine neden olmuştu. </p>

<p><a href="http://kissa.be">Kissa.be</a>'nin bulunduğu bir önceki sunucu da (Debian 4.0) bir dosya için ayrılması düşünülen dosya indeks boyutu (bytes-per-inode) 4096 ve dosya indeks alanı ise 128 idi. Şuan mevcut sunucumda (Ubuntu 9.10) ise varsayılan kurulum ayarları (8096 / 128) olarak geliyor.</p>

<p>Diskinize ait inode ve block gibi değerleri görmek için;</p>

<blockquote>
	<table class="info">
		<tr>
			<td colspan="2"><p>root@localhost:~#<strong> tune2fs -l /dev/sdc</strong></p></td>
		</tr>
		<tr>
			<th>Inode count:</th>
			<td>1280000</td>
		</tr>
		<tr>
			<th>Free inodes:</th>
			<td>1255224</td>
		</tr>
		<tr>
			<th>Inodes per group:</th>
			<td>32000</td>
		</tr>
		<tr>
			<th>Inode blocks per group:</th>
			<td>1000</td>
		</tr>
		<tr>
			<th>Inode size:</th>
			<td>128</td>
		</tr>
	</table>
</blockquote>

<p>Sorunu tespit ettikten sonra çözüm bulmak gerçekten çok kolay oluyor. Linux'ta kissa.be servisine özel bir disk alanı gerekiyordu. Sunucuda inode değerleri ihtiyacıma göre olan bir alan yaratınca sorun kökten çözüldü. Böylece sunucunun işletim sistemi bu durumdan hiç etkilenmedi. </p>

<p>Diski inode değerlerine göre yeniden biçimlendirirken;</p>

<blockquote>

 root@localhost:~# <strong>mkfs.ext3 -i 4096 -I 128 /dev/sdc</strong>
</blockquote>

<p>Aslında bu konularda uzman biri olduğumu pek söyleyemem. Çok anlamam ama, linux sistemiyle uğraşmayı, sistem programlama konularını seviyorum. </p>

<p>Yazının ana fikrine gelecek olursak;</p>

<p>Eğer kissa.be heveskar bir gencin projesi değil de, bit.ly gibi planlı bir proje olsaydı, gereksinim analizini okuyan bir Sistem Mimari servise ait dosyaları barındıran diskin formatlanması konusunda inode detayını atlamazdı.</p>

<p>Yaşadığım bu olay, bugün öğrendiğim küçük bir ders oldu!...</p>


      <!--
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/blog/2009/12/03/pratisyen-hekim-veya-kalp-cerrahi-olmak" title="Pratisyen Hekim veya Kalp Cerrahı Olmak">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/blog/2010/01/13/sanal-pos-kutuphanesi" title="Sanal Pos Kütüphanesi">Next &rarr;</a></li>
      
      </ul>
    </div>-->
    <p>&nbsp;</p>
    
  </div>
  
</div>


        </div>
    </div>
</div>
<!-- /container -->


<footer class="footer">
    <div class="container">
        <p class="pull-right"> | <a href="#">Başa Dön</a> | </p>

        <p>
            &copy; 2007 - 2013 Hasan Ozgan<br/>
            <small>En son güncellenme tarihi: Kasım 04, 2013</small>
        </p>

    </div>
</footer>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
<script src="/assets/themes/heves/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/assets/themes/heves/js/jquery.followbox.min.js" type="text/javascript"></script>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1491715-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>

