
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Bir SQL Hikayesi</title>
    
    <meta name="author" content="Hasan Ozgan">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/heves/css/bootstrap-combined.min.css" rel="stylesheet">
    <link href="/assets/themes/heves/css/docs.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/heves/js/google-code-prettify/prettify.css" rel="stylesheet">
    <link href="/assets/themes/heves/css/followbox.css" rel="stylesheet" type="text/css"/>

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
</head>

<body>

<div class="navbar navbar-fixed-top">
<a href="http://www.reactivemanifesto.org/"><img style="border: 0; position: fixed; right: 0; top:41px; z-index: 9000" src="http://www.reactivemanifesto.org/images/ribbons/we-are-reactive-red-right.png"></a> 
    <div class="navbar-inner">
        <div class="container" style="width:1200px">
           <a class="brand" href="/">Internet Stratejileri, Yazılım Geliştirme ve Mimarileri Üzerine</a>

            <div class="nav-collapse">
                <ul class="nav">
                    <li>
                        <a href="/"><i class="icon-home"></i> Anasayfa</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-briefcase"></i> Belgeler <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        	<li><a href="/blog/2013/03/30/fonksiyonel-programlama/" target="_blank">Fonksiyonel Programlama</a></li>
                            <li><a href="/belgeler/scala-rehberi" rel="tooltip" title="Scala Rehberi" target="_blank">Scala Rehberi</a></li>
                            <li><a href="/belgeler/tasarim-desenleri" rel="tooltip" title="Tasarım Desenleri" target="_blank">Tasarım Desenleri</a></li>
                            <li><a href="/belgeler/tasarim-prensipleri" rel="tooltip" title="Tasarım Prensipleri" target="_blank">Tasarım Prensipleri</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="https://github.com/HasanOzgan"><i class="icon-globe"></i> Projeler</a>
                    </li>
                    <li><a href="/archive"><i class="icon-folder-open"></i> Arşiv</a></li>
                    <li>
                        <a href="/hakkinda"><i class="icon-user"></i> Hakkımda</a>
                    </li>
                    
                </ul>
            </div>

        </div>
    </div>
</div>

<div class="container">
    <div class="marketing">
        <div class="content">
            


<div class="row">
    <div class="span12 column">
        <p></p><h1>Bir SQL Hikayesi</h1><p></p>
    </div>
</div>

<div class="row">
    <div class="span8 column">
        <!--<h5><strong>Ocak 31, 2007 <small> | <a href="/blog/2007/01/31/bir-sql-hikayesi#disqus_thread" data-disqus-identifier="/blog/2007/01/31/bir-sql-hikayesi">Yorumlar</a></small></strong><br>-->

        
            <i class="icon-tags"></i> Etiketler :
            
                <a href="tag/Diğer" rel="tooltip" title="View posts tagged with &quot;Diğer&quot;"><span class="label label-info">Diğer</span></a>
            
        


    </div>
    <div class="span4 column">
        <p class="pull-right">
            
            <a href="/blog/2006/01/21/hello-world" title="Merhaba Dünya! (ver. 2.0)"><i class="icon-chevron-left"></i></a>
            
            
            <a href="/blog/2007/02/28/turkiyede-sosyal-muhendislik" title="Türkiye'de Sosyal Mühendislik"><i class="icon-chevron-right"></i></a>
            
        </p>
    </div>
</div>

<div class="row">
  <div class="span12">
    <hr style="margin: 30px 0 30px 0"/>

      Bazen MS-SQL kullandığımı unutup, MySQL'deki gibi sorgular yazıyorum. Geçen zaman diliminde geliştirdiğim bir projenin DB yapısında bazı refactoring işlemleri yaptıktan sonra; göç (migration) için gerekli olan SQL betiklerini(script) yazdım. Tabii alışkanlıktan aşağıdaki gibi bir betik hazırladım.
<p style="padding-left: 50px"><span style="color: #0000ff;">UPDATE </span>
<span style="color: #000000;">Bid b, </span>
<span style="color: #0000ff;">Product </span>
<span style="color: #000000;">p </span>
<span style="color: #0000ff;">SET </span>
<span style="color: #000000;">p.CategoryId=b.CategoryId </span>

<span style="color: #0000ff;">WHERE </span>
<span style="color: #000000;">b.ProductId = p.Id;</span>

Daha sonra, yazdığım göç betiklerini test ederken gördüm ki, MSSQL bu işlemi desteklemiyor. Böyle bir işlemi yapabilmek için T-SQL yazmak gerekiyor. Sonrada aşağıda gördüğünüz kodu yazdım.

Buraya da yazayım dedim; belki birinin T-SQL'de CURSOR örneğine ihtiyacı olur yada yukarıdaki gibi MySQL'de ki gibi MSSQL'de Multiple Update işlemi yapmak ister :-)
<p style="padding-left:50px"><span style="color: #0000ff;">DECLARE </span>
cr_BidCategoryToProductCategory
<span style="color: #0000ff;">CURSOR FOR </span>

<span style="color: #0000ff;">SELECT DISTINCT </span>
p.Id, b.CategoryId
<span style="color: #0000ff;">FROM </span>
Bid b,
<span style="color: #0000ff;">Product </span>p

<span style="color: #0000ff;">WHERE </span>
b.ProductId = p.Id;

<span style="color: #0000ff;">DECLARE </span>@productId
<span style="color: #0000ff;">int</span>, @categoryId
<span style="color: #0000ff;">int</span>;

<span style="color: #0000ff;">OPEN </span>
cr_BidCategoryToProductCategory;

<span style="color: #0000ff;">FETCH </span>
cr_BidCategoryToProductCategory
<span style="color: #0000ff;">INTO </span>@productId, @categoryId

<span style="color: #0000ff;">WHILE </span>(@@FETCH_STATUS = 0)

<span style="color: #0000ff;">BEGIN
</span>
<span style="color: #0000ff;">UPDATE Product SET </span>
CategoryId = @categoryId
<span style="color: #0000ff;">WHERE </span>Id = @productId;

<p style="padding-left:50px"><span style="color: #0000ff;">FETCH </span>
cr_BidCategoryToProductCategory
<span style="color: #0000ff;">INTO </span>
@productId, @categoryId

<span style="color: #0000ff;">END
CLOSE </span>
cr_BidCategoryToProductCategory;

<span style="color: #0000ff;">DEALLOCATE </span>
cr_BidCategoryToProductCategory;


      <!--
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/blog/2006/01/21/hello-world" title="Merhaba Dünya! (ver. 2.0)">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/blog/2007/02/28/turkiyede-sosyal-muhendislik" title="Türkiye'de Sosyal Mühendislik">Next &rarr;</a></li>
      
      </ul>
    </div>-->
    <p>&nbsp;</p>
    
  </div>
  
</div>


        </div>
    </div>
</div>
<!-- /container -->


<footer class="footer">
    <div class="container">
        <p class="pull-right"> | <a href="#">Başa Dön</a> | </p>

        <p>
            &copy; 2007 - 2013 Hasan Ozgan<br/>
            <small>En son güncellenme tarihi: Kasım 04, 2013</small>
        </p>

    </div>
</footer>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
<script src="/assets/themes/heves/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/assets/themes/heves/js/jquery.followbox.min.js" type="text/javascript"></script>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1491715-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>

